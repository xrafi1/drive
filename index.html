<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO & Metadata -->
    <title>MANAS ACADEMY Official Results Portal - Check Examination Results</title>
    <meta name="description" content="Official examination results portal for MANAS ACADEMY. Securely check your academic performance and grades. End-to-End Encryption Security ensured.">
    <meta name="keywords" content="MANAS ACADEMY, MANAS, results, examination, grades, check result, official portal, edumark">
    <link rel="canonical" href="https://your-domain.com/"> <!-- Replace with actual domain -->

    <!-- Open Graph / Social Media Tags for SEO -->
    <meta property="og:title" content="MANAS ACADEMY Official Results Portal">
    <meta property="og:description" content="Securely check your MANAS ACADEMY examination results online with end-to-end encryption.">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://i.ibb.co/jvrzFN7P/FB-IMG-1758899398997.png"> 
    <!-- End SEO & Metadata -->
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="https://i.ibb.co/jvrzFN7P/FB-IMG-1758899398997.png">

    <!-- Structured Data (JSON-LD) for Educational Organization -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "EducationalOrganization",
      "name": "MANAS ACADEMY",
      "url": "https://your-domain.com/", 
      "logo": "https://i.ibb.co/jvrzFN7P/FB-IMG-1758899398997.png",
      "description": "The official results checking portal for MANAS ACADEMY students, developed by Rafi Sheikh."
    }
    </script>
    
    <!-- Lottie Web Component Script for Animations -->
    <script src="https://unpkg.com/@lottiefiles/dotlottie-wc@0.8.5/dist/dotlottie-wc.js" type="module"></script>
    
    <!-- Load Tailwind CSS --><script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for the embedded content to ensure it fills the modal nicely */
        #embed-modal {
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal-content-container {
            /* 95% width and height for a slight border around the iframe */
            width: 95vw; 
            height: 95vh;
            display: flex; /* Required for the loading indicator layer */
            flex-direction: column;
        }
        
        /* Spinner animation for UX */
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid #EB001B; /* Primary color */
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    <!-- Use Inter font family for a modern look --><script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        primary: '#EB001B', /* Mastercard Red */
                        primarydark: '#FF5F00', /* Mastercard Orange for hover */
                    }
                }
            }
        }
    </script>
</head>
<body class="font-sans bg-gray-50 min-h-screen flex flex-col">

    <!-- Diwali Greeting Banner -->
    <div class="bg-primary text-white text-center py-2 px-4 shadow-lg flex items-center justify-center space-x-2">
        <p class="text-sm sm:text-base font-semibold">Wishing you and your family a Happy Diwali!</p>
        <dotlottie-wc src="https://lottie.host/fe2843ea-ee44-42fa-8d50-8f389c75b895/VQVnPdizb9.lottie" 
                      style="width: 30px; height: 30px; filter: drop-shadow(0 0 2px #FF5F00)" 
                      autoplay loop>
        </dotlottie-wc>
    </div>

    <!-- Header Section -->
    <header class="bg-white shadow-md">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex items-center space-x-4">
            <!-- MANAS ACADEMY Logo in Header -->
            <img src="https://i.ibb.co/jvrzFN7P/FB-IMG-1758899398997.png" 
                 alt="MANAS ACADEMY Logo" 
                 class="h-10 w-auto">
            <div>
                <h1 class="text-2xl font-bold text-gray-900">
                    MANAS ACADEMY
                </h1>
                <p class="text-sm text-primary">Official Examination Results Portal</p>
            </div>
        </div>
    </header>

    <!-- Main Hero/Content Section --><main class="flex-grow flex items-center justify-center p-4">
        <div class="text-center bg-white p-6 sm:p-10 rounded-2xl shadow-xl max-w-lg w-full transform transition duration-500 hover:scale-[1.02]">
            
            <!-- MANAS ACADEMY Logo in Hero Section -->
            <img src="https://i.ibb.co/jvrzFN7P/FB-IMG-1758899398997.png" 
                 alt="MANAS ACADEMY Logo" 
                 class="mx-auto h-20 w-auto mb-6">

            <h2 id="statusMessage" class="text-3xl sm:text-4xl font-extrabold text-gray-900 mb-3">
                Sign in to View Results
            </h2>
            <p class="text-lg text-gray-600 mb-8">
                Access your academic performance records securely. Please sign in with your Google account.
            </p>

            <!-- Authentication/Action Container -->
            <div id="auth-container">
                <!-- Google Sign-In Button (Initial state: Visible) -->
                <button id="googleSignInButton" 
                        class="w-full sm:w-auto px-10 py-4 bg-white border border-gray-300 text-gray-700 font-bold rounded-xl shadow-lg 
                               hover:bg-gray-50 transition duration-300 transform hover:translate-y-[-2px] 
                               focus:outline-none focus:ring-4 focus:ring-gray-300/50 text-xl tracking-wider flex items-center justify-center mx-auto">
                    <!-- Google Icon SVG -->
                    <svg class="w-6 h-6 mr-3" viewBox="0 0 48 48">
                        <path fill="#4285F4" d="M24 10.2c3.48 0 5.8 1.43 7.18 2.76l5.08-5.08C33.72 4.7 29.28 3 24 3 14.63 3 6.64 8.24 3.75 16.03l5.88 4.54C11.3 14.7 17.06 10.2 24 10.2z"/>
                        <path fill="#34A853" d="M44.5 24c0-1.87-.16-3.4-.42-4.8H24v9.1h11.83c-.49 2.5-1.92 4.47-3.9 5.86l5.08 4.08C42.02 33.15 44.5 28.71 44.5 24z"/>
                        <path fill="#FBBC05" d="M12.9 28.7c-.5-1.53-.78-3.15-.78-4.7s.28-3.17.78-4.7l-5.88-4.54C6.64 15.22 5 19.46 5 24c0 4.54 1.64 8.78 4.02 11.96l5.88-4.54c-.5-1.53-.78-3.15-.78-4.7z"/>
                        <path fill="#EA4335" d="M24 43c5.38 0 9.94-1.78 13.25-4.83l-5.08-4.08c-1.8 1.15-4.04 1.84-6.17 1.84-6.94 0-12.7-4.5-14.83-10.79l-5.88 4.54C6.64 39.76 14.63 43 24 43z"/>
                    </svg>
                    Sign in with Google
                </button>

                <!-- CTA Button (Initial state: Hidden) -->
                <button id="checkResultButton" 
                        style="display: none;"
                        class="w-full sm:w-auto px-10 py-4 bg-primary text-white font-bold rounded-xl shadow-lg 
                               hover:bg-primarydark transition duration-300 transform hover:translate-y-[-2px] 
                               focus:outline-none focus:ring-4 focus:ring-primary/50 text-xl tracking-wider"> 
                    Check Result Now
                </button>
            </div>


            <!-- Checkmark Lottie Animation -->
            <dotlottie-wc src="https://lottie.host/419ce1b9-b10c-4564-9282-c95bd616f967/VSXvQ0yKHl.lottie" 
                          style="width: 150px; height: 150px" 
                          class="mx-auto mt-8"
                          autoplay loop>
            </dotlottie-wc>

        </div>
    </main>

    <!-- Footer Section --><footer class="bg-white border-t border-gray-100 p-4 text-center">
        <!-- Security Assurance -->
        <p class="text-xs font-semibold text-green-600 mb-1">
            End-to-End Encryption Security
        </p>
        <p class="text-sm text-gray-500">
            &copy; 2025 MANAS ACADEMY. All Rights Reserved.
        </p>
        <!-- Developer Credit -->
        <p class="text-xs text-gray-400 mt-1">
            Developed by Rafi Sheikh
        </p>
    </footer>

    <!-- Result Embed Modal Overlay --><div id="embed-modal" 
         class="fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center 
                opacity-0 invisible pointer-events-none p-2">
        
        <div class="modal-content-container bg-white rounded-lg shadow-2xl relative flex flex-col">
            
            <!-- Loading Indicator -->
            <div id="loadingIndicator" class="absolute inset-0 bg-gray-100/90 z-40 flex items-center justify-center rounded-lg transition-opacity duration-300 opacity-0 invisible">
                <div class="flex flex-col items-center">
                    <div class="spinner !border-t-primary !border-4 mb-3"></div>
                    <p class="text-gray-700 font-semibold">Loading results securely...</p>
                </div>
            </div>

            <!-- Close Button --><button id="closeModalButton" 
                    class="absolute top-2 right-2 text-white bg-primary hover:bg-primarydark p-2 rounded-full 
                           z-50 transition duration-150 transform hover:scale-105" 
                    aria-label="Close">
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>

            <!-- Iframe Container --><iframe id="resultIframe" 
                    src="" 
                    title="External Results System" 
                    class="w-full h-full rounded-lg border-none opacity-0 transition-opacity duration-300"
                    allow="clipboard-write">
            </iframe>
        </div>
    </div>

    <!-- Firebase and Application Logic -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        
        // Provided Firebase Config
        const firebaseConfig = {
          apiKey: "AIzaSyADMnb-g9z76CxNGlmNsMPxFQ5Zge91WN8",
          authDomain: "pvtschool-48c32.firebaseapp.com",
          projectId: "pvtschool-48c32",
          storageBucket: "pvtschool-48c32.firebasestorage.app",
          messagingSenderId: "531940116523",
          appId: "1:531940116523:web:4cbe6b748b14ce492a426e",
          measurementId: "G-KHXPMWXC5F"
        };

        // Initialize Firebase
        try {
            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            const googleProvider = new GoogleAuthProvider();
            console.log("Firebase initialized successfully.");

            // DOM elements
            const checkResultButton = document.getElementById('checkResultButton');
            const embedModal = document.getElementById('embed-modal');
            const closeModalButton = document.getElementById('closeModalButton');
            const resultIframe = document.getElementById('resultIframe');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const googleSignInButton = document.getElementById('googleSignInButton');
            const statusMessage = document.getElementById('statusMessage');

            const targetUrl = "https://result.edumark.site";

            // --- Authentication Handlers ---

            // Google Sign In Handler
            googleSignInButton.addEventListener('click', async () => {
                try {
                    console.log("Attempting Google Sign-In...");
                    // This uses a pop-up window for sign-in
                    const result = await signInWithPopup(auth, googleProvider);
                    const user = result.user;
                    console.log("User signed in:", user.email);
                    // UI update is handled by onAuthStateChanged
                } catch (error) {
                    console.error("Google Sign-In Error:", error.code, error.message);
                    
                    // Specific error handling for pop-up closed/blocked
                    if (error.code === 'auth/popup-closed-by-user') {
                        statusMessage.textContent = "Sign-in cancelled. Please try again.";
                    } else if (error.code === 'auth/popup-blocked') {
                        statusMessage.textContent = "Pop-up blocked. Please allow pop-ups for this site.";
                    } else {
                        statusMessage.textContent = "Authentication Failed. Please check your connection and try again.";
                    }
                    statusMessage.classList.add('text-primary'); // Highlight error message
                }
            });

            // Auth State Listener: Manages UI based on sign-in status
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    // User is signed in
                    googleSignInButton.style.display = 'none';
                    checkResultButton.style.display = 'inline-block';
                    // Display customized welcome message
                    const displayName = user.displayName ? user.displayName.split(' ')[0] : user.email;
                    statusMessage.innerHTML = `Welcome back, <span class="text-primary">${displayName}!</span>`;
                    statusMessage.classList.remove('text-primary'); // Clear error highlight
                    document.querySelector('p.text-lg').textContent = "You are now verified. Click below to view your official results.";
                } else {
                    // User is signed out
                    googleSignInButton.style.display = 'block';
                    checkResultButton.style.display = 'none';
                    statusMessage.textContent = "Sign in to View Results";
                    document.querySelector('p.text-lg').textContent = "Access your academic performance records securely. Please sign in with your Google account.";
                }
            });

            // --- Modal Functions (Preserved) ---

            /**
             * Opens the modal and loads the external URL into the iframe.
             */
            function openModal() {
                // Ensure user is signed in before opening the modal
                if (!auth.currentUser) {
                    console.warn("Attempted to open modal without signing in.");
                    // In a real app, you might show a persistent sign-in reminder here.
                    statusMessage.textContent = "Please sign in first to check results.";
                    return;
                }

                // Show loading indicator
                loadingIndicator.classList.remove('opacity-0', 'invisible');
                resultIframe.classList.add('opacity-0');

                // Set the iframe source to the required URL
                resultIframe.src = targetUrl;
                
                // Make the modal visible and opaque
                embedModal.classList.remove('opacity-0', 'invisible', 'pointer-events-none');
                embedModal.classList.add('opacity-100', 'pointer-events-auto');
                
                // Optional: Disable scrolling on the body when modal is open
                document.body.style.overflow = 'hidden';
                console.log(`Loading external result page: ${targetUrl}`);
            }

            /**
             * Closes the modal and resets the iframe source (to stop any ongoing processes).
             */
            function closeModal() {
                // Hide the modal
                embedModal.classList.remove('opacity-100', 'pointer-events-auto');
                embedModal.classList.add('opacity-0', 'invisible', 'pointer-events-none');
                
                // Hide loading indicator and clear source
                loadingIndicator.classList.add('opacity-0', 'invisible');
                resultIframe.classList.add('opacity-0');
                resultIframe.src = "about:blank";

                // Optional: Re-enable scrolling on the body
                document.body.style.overflow = '';
                console.log('Result modal closed.');
            }

            // Hide loading indicator once the iframe content has loaded
            resultIframe.onload = function() {
                loadingIndicator.classList.add('opacity-0', 'invisible');
                resultIframe.classList.remove('opacity-0');
            };

            // Event listeners
            checkResultButton.addEventListener('click', openModal);
            closeModalButton.addEventListener('click', closeModal);

            // Close modal if user clicks outside the content (on the overlay itself)
            embedModal.addEventListener('click', (e) => {
                if (e.target === embedModal) {
                    closeModal();
                }
            });

            // Close modal using the Escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && embedModal.classList.contains('opacity-100')) {
                    closeModal();
                }
            });

        } catch (e) {
            console.error("Critical Firebase Initialization Error:", e);
        }

    </script>
</body>
</html>
